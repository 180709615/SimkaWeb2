@*@model SimkaDosenPenelitian*@
@using  Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{ ViewData["Title"] = "View";
    Layout = "~/Views/Shared/_LayoutDynamic.cshtml"; }

<link rel="stylesheet" href="~/plugins/fontawesome-free/css/all.min.css">
<!-- overlayScrollbars -->
<link rel="stylesheet" href="~/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
<!-- Theme style -->





<head>
    <title>Profil @HttpContextAccessor.HttpContext.Session.GetString("Nama") - SIMKA UAJY</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
    <style>
        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 90px;
            height: 90px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
        }

        /* Safari */
        @@-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @@keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>

</head>
<body>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <input type="button" value="Kembali" class="btn btn-danger" onclick="history.back(-1)" />
                    </div>

                </div>
            </div><!-- /.container-fluid -->

        </section>

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-3">

                        <input type="hidden" id="nppa" value=@Model.Karyawan.Npp />

                        <!-- Profile Image -->
                        <div class="card card-primary">
                            <div class="card-header">
                                <h3 class="card-title">Biodata</h3>
                            </div>
                            <div class="card-body box-profile">
                                <div class="text-center">
                                    @if (Model.Karyawan.FileFoto != null)
                                    {
                                        <img class="profile-user-img img-fluid img-circle"
                                             src="data:image/jpeg;base64,@System.Convert.ToBase64String(Model.Karyawan.FileFoto)"
                                             alt="User profile picture">}
                                </div>
                                <br>
                                <h4 class=" text-center"><b>@Model.Karyawan.Npp </b></h4>
                                <h3 class="profile-username text-center"> @Model.Karyawan.NamaLengkapGelar</h3>

                                <p class=" text-center">
                                    <b>

                                        @if (Model.Karyawan.IdUnitNavigation != null)
                                        {
                                            @Model.Karyawan.IdUnitNavigation.NamaUnit
                                            <br>
                                            @if (@Model.Karyawan.MstIdUnitNavigation != null)
                                            {
                                                @if (@Model.Karyawan.IdUnitNavigation.NamaUnit != @Model.Karyawan.MstIdUnitNavigation.NamaUnit)
                                                {
                                                    @Model.Karyawan.MstIdUnitNavigation.NamaUnit}}}


                                    </b>
                                </p>


                                <ul class="list-group list-group-unbordered mb-3">
                                    <li class="list-group-item">
                                        @if (Model.Akademik != null)
                                        {
                                            <b>Program Sudi</b> <a class="float-right">@Model.Akademik.NamaUnitAkademik </a>}

                                    </li>
                                    <li class="list-group-item">
                                        <b>Tempat Tanggal LAhir</b> <a class="float-right">
                                            @Model.Karyawan.TempatLahir -
                                            @Model.Karyawan.TglLahir
                                        </a>
                                    </li>
                                    <li class="list-group-item">
                                        <b>Email</b> <a class="float-right">@Model.Karyawan.Email</a>
                                    </li>
                                </ul>

                                <a><b>Alamat: </b> @Model.Karyawan.Alamat</a>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                        <!-- About Me Box -->
                        <div class="card card-primary">
                            <div class="card-header">
                                <h3 class="card-title">Riwayat Pendidikan</h3>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div style="overflow-x:auto;">
                                    <table id="tabelpendidikan" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                        <thead>
                                            <tr>
                                                <th> No</th>
                                                <th> Nama Sekolah</th>
                                                <th> Jenjang</th>
                                                <th> Program Studi</th>
                                                <th> Status</th>
                                                <th> Tahun Lulus</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                            <!-- /.card-body -->


                        </div>
                        <button type="button" class="btn btn-danger btn-block" style="width:100%;" onclick="goToUbahPassword()">Reset Password</button>

                        <!-- /.card -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-header p">
                                <ul class="nav nav-pills">
                                    <li class="nav-item"><a class="nav-link active" href="#biografi" data-toggle="tab">Biografi</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#pengajaran" data-toggle="tab">Pengajaran</a></li>

                                    <li class="nav-item"><a class="nav-link" href="#penelitian" data-toggle="tab">Penelitian</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#publikasi" data-toggle="tab">Publikasi</a></li>
                                    <li class="nav-item"><a class="nav-link" href="#pengabdian" data-toggle="tab">Pengabdian</a></li>
                                </ul>
                            </div><!-- /.card-header -->
                            <div class="card-body">
                                <div class="tab-content">
                                    <div class="active tab-pane" id="biografi">
                                        <div class="card-body pad">
                                            <div class="mb-3">

                                                @Html.Raw(@Model.Karyawan.BiografiSingkat)


                                            </div>

                                        </div>

                                    </div>

                                    <div class="tab-pane" id="pengajaran">

                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1">
                                                <b> Pengajaran dari SISTER </b>

                                            </div>
                                            <div>
                                                <span>Terakhir disinkron: </span>
                                                @if (Model.LastUpdatedPengajaran != null)
                                                {
                                                    <span>@Model.LastUpdatedPengajaran</span>
                                                }
                                                else
                                                {
                                                    <span>-</span>
                                                }
                                                <span>hari lalu</span>

                                            </div>
                                            <div class="pl-3">
                                                <button class=" text-light btn btn-success" disabled
                                                        onclick="SinkronPengajaranSISTER()">
                                                    <i class="fa fa-refresh"></i> Sinkronisasi
                                                </button>
                                            </div>

                                        </div>

                                        <div style="overflow-x:auto;">
                                            <span style="margin-left:1%">Semester</span>
                                            <select onchange="changeSelect()" class="form-select form-select-md selectSemester" style="margin-left:20px;">
                                                <!--option value="0">-- Pilih Semester --</!--option-->
                                                @foreach (var item in Model.semester)
                                                {
                                                    @*<option value="@item.id_semester">@item.semester</option>*@
                                                    <option value="@item.id">@item.nama</option>

                                                }
                                            </select>
                                            <table id="tabelpengajaran" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                                <thead>
                                                    <tr>

                                                        <th> No</th>
                                                        <th> Nama mata Kuliah</th>
                                                        <th>Semester</th>
                                                        <th> Kelas</th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>


                                        </div>
                                    </div>

                                    <!---  Penelitian-->


                                    <div class="tab-pane" id="penelitian">

                                        <b> Penelitan LPPM</b>
                                        <div style="overflow-x:auto;">
                                            <table id="penelitian" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                                <thead>
                                                    <tr>

                                                        <th> Judul Penelitian</th>
                                                        <th> Keluaran</th>
                                                        <th> Tanggal Mulai</th>
                                                        <th> Tanggal Selesai</th>
                                                        <th> Lokasi</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (Model.Penelitian != null)
                                                    {
                                                        int no = 0;
                                                        @foreach (var r in Model.Penelitian)
                                                        {
                                                            no++;
                                                            <tr>
                                                                <td>
                                                                    @no;
                                                                    @r.Judul
                                                                </td>
                                                                <td>
                                                                    @r.Outcome
                                                                </td>
                                                                <td>
                                                                    @r.Awal
                                                                </td>
                                                                <td>
                                                                    @r.Akhir
                                                                </td>
                                                                <td>
                                                                    @r.Lokasi
                                                                </td>
                                                            </tr>
                                                        } }
                                                    else
                                                    {
                                                        <tr>

                                                            <td> Tidak ada data pada LPPM</td>

                                                        </tr>
                                                    }


                                                </tbody>
                                            </table>
                                        </div>

                                        <b>Penelitian dari Pengembangan </b>
                                        <div style="overflow-x:auto;">
                                            <table id="tabelpengembangansimka" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                            </table>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1">
                                                <b>Penelitian dari Sister</b>
                                            </div>
                                            <div>
                                                <span>Terakhir disinkron: </span>
                                                @if (Model.LastUpdatedPenelitian != null)
                                                {
                                                    <span>@Model.LastUpdatedPenelitian</span>
                                                }
                                                else
                                                {
                                                    <span>-</span>
                                                }
                                                <span>hari lalu</span>

                                            </div>
                                            <div class="pl-3">
                                                <button class=" text-light btn btn-success"
                                                        onclick="SinkronPenelitianSISTER()">
                                                    <i class="fa fa-refresh"></i> Sinkronisasi
                                                </button>
                                            </div>

                                        </div>
                                        <table id="penelitiansister" style="width: 100% !important; " class="table table-md table-striped table-bordered m-2">
                                            <thead>
                                                <tr>
                                                    <th> NO </th>
                                                    <th> Judul Penelitian</th>
                                                    <th> Durasi Kegiatan</th>
                                                    <th> Skim Penelitan</th>
                                                    <th> Tahun Ajaran</th>
                                                    <th> Peran</th>




                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>



                                    <!--- / Penelitian-->
                                    <!-- /.card-header -->
                                    <!---  Publikasi-->
                                    <div class="tab-pane" id="publikasi">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1">
                                                <b>Publikasi dari SISTER</b>
                                            </div>
                                            <div>
                                                <span>Terakhir disinkron: </span>
                                                @if (Model.LastUpdatedPublikasi != null)
                                                {
                                                    <span>@Model.LastUpdatedPublikasi</span>
                                                }
                                                else
                                                {
                                                    <span>-</span>
                                                }
                                                <span>hari lalu</span>

                                            </div>
                                            <div class="pl-3">
                                                <button class=" text-light btn btn-success"
                                                        onclick="SinkronPublikasiSISTER()">
                                                    <i class="fa fa-refresh"></i> Sinkronisasi
                                                </button>
                                                @*<button class=" text-light btn btn-danger"
                                                            onclick="clickexport()">
                                                        <i class="fa fa-print"></i> Export Excel
                                                    </button>*@
                                            </div>

                                        </div>
                                        <div style="overflow-x:auto;">
                                            <table id="tabelpublikasi" style="width: 100% !important; " class="table-hover table table-striped table-bordered  ">
                                                @*<table id="tabelpublikasi" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">*@
                                                <thead>
                                                    <tr>

                                                        <th>NO</th>
                                                        <th> Judul Penelitian</th>
                                                        <th> Kategori Kegiatan</th>
                                                        <th> Tanggal </th>
                                                        <th> Peran </th>
                                                        <th> Urutan </th>
                                                        @*<th> Nama Artikel </th>*@
                                                        <th> Dokumen Sister </th>
                                                        <th> Dokumen Pendukung </th>


                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!--- / Publikasi-->
                                    </div>

                                    <div class="tab-pane" id="pengabdian">
                                        <b>Pengabdian dari Simka</b>
                                        <table style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                            <thead>
                                                <tr>

                                                    <th> Judul Penelitian</th>
                                                    <th> Keluaran</th>
                                                    <th> Tanggal Mulai</th>
                                                    <th> Tanggal Selesai</th>
                                                    <th> Lokasi</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                @if (Model.Pengabdian.Count != 0)
                                                {
                                                    @foreach (var r in Model.Pengabdian)
                                                    {
                                                        <tr>
                                                            <td>

                                                                @r.JudulKegiatan
                                                            </td>
                                                            <td>
                                                                @r.Outcome
                                                            </td>
                                                            <td>
                                                                @r.Awal
                                                            </td>
                                                            <td>
                                                                @r.Akhir
                                                            </td>
                                                            <td>
                                                                @r.Lokasi
                                                            </td>
                                                        </tr>
                                                    } }
                                                else

                                                {
                                                    <tr>

                                                        <td> Tidak ada data pada SIMKA</td>

                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                        <div class="d-flex align-items-center">
                                            <div class="flex-grow-1">
                                                <b>Pengabdian dari Sister</b>
                                            </div>
                                            <div>
                                                <span>Terakhir disinkron: </span>
                                                @if (Model.LastUpdatedPengabdian != null)
                                                {
                                                    <span>@Model.LastUpdatedPengabdian</span>
                                                }
                                                else
                                                {
                                                    <span>-</span>
                                                }
                                                <span>hari lalu</span>

                                            </div>
                                            <div class="pl-3">
                                                <button class=" text-light btn btn-success"
                                                        onclick="SinkronPengabdianSISTER()">
                                                    <i class="fa fa-refresh"></i> Sinkronisasi
                                                </button>
                                            </div>

                                        </div>
                                        <table id="tabelpengabdian" style="width: 100% !important; " class="table table-sm table-striped table-bordered m-2">
                                            <thead>
                                                <tr>
                                                    <th>NO</th>
                                                    <th> Judul Penelitian</th>
                                                    <th> Durasi Kegiatan</th>
                                                    <th> Skim Penelitan</th>
                                                    <th> Tahun Ajaran</th>
                                                    <th> Peran</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>




                                    </div>






                                </div>

                            </div>
                        </div>
                        <!-- /.tab-content -->

                    </div><!-- /.card-body -->
                </div>
            </div>
            <!-- /.nav-tabs-custom -->
            <!-- /.col -->
            <!-- /.row -->
        </section>
        <!-- /.container-fluid -->
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Version</b> 3.0.2
        </div>
        <small>Copyright &copy; 2014-2019 <a href="http://adminlte.io">AdminLTE.io</a>.</small> All rights
        reserved.
    </footer>


    <!-- /.control-sidebar -->



</body>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg mw-100 w-75" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Dokumen Pendukung</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @*<form action="@Url.Action("PostDokumenPendukungPublikasi","SimkaDosen")" method="POST" enctype="multipart/form-data">*@
            <form>

                <div class="modal-body">
                    <div class="container-fluid">
                        @*<label>ID Publikasi</label>*@
                        <input type="hidden" class="form-control" id="id" name="id" readonly>

                        <div class="row justify-content-between" style="margin-top:1%;">
                            <div class="col-md-4" style="margin-right:1%" ;>
                                <label>Dokumen Prosiding Artikel</label>
                                <div class=" custom-file mb-3">
                                    <input type="file" accept=".pdf" class="custom-file-input" id="file_prosiding" name="file_prosiding" onchange="getFileNameWithExt(event,'labelProsiding')">
                                    <label class="custom-file-label" id="labelProsiding" for="file_prosiding">Choose file...</label>
                                    @*pakai <object> kaya di situs kkn bisa*@
                                </div>

                                <label>Dokumen Cek Similaritas</label>
                                <div class="custom-file mb-3">
                                    <input type="file" accept=".pdf" class="custom-file-input" id="file_cek_similaritas" name="file_cek_similaritas" onchange="getFileNameWithExt(event,'labelSimilaritas')">
                                    <label class="custom-file-label" id="labelSimilaritas" for="file_cek_similaritas">Choose file...</label>
                                    @*pakai <object> kaya di situs kkn bisa*@
                                </div>

                                <label>Dokumen Peer Review PAK</label>
                                <div class="custom-file mb-3">
                                    <input type="file" accept=".pdf" class="custom-file-input" id="file_PAK" name="file_PAK" onchange="getFileNameWithExt(event,'labelPAK')">
                                    <label class="custom-file-label" id="labelPAK" for="file_PAK">Choose file...</label>
                                    @*pakai <object> kaya di situs kkn bisa*@
                                </div>

                                <label>Dokumen Peer Review Korespondensi</label>
                                <div class="custom-file mb-3">
                                    <input type="file" accept=".pdf" class="custom-file-input" id="file_korespondensi" name="file_korespondensi" onchange="getFileNameWithExt(event,'labelKorespondensi')">
                                    <label class="custom-file-label" id="labelKorespondensi" for="file_korespondensi">Choose file...</label>
                                    @*pakai <object> kaya di situs kkn bisa*@
                                </div>
                                <button type="button" onclick="PostDokumenPendukung()" class="btn btn-primary">Save changes</button>

                            </div>

                            <div class="col-md-7 " style="margin-left:1%" ;>
                                <div class="card shadow ">
                                    <div class="card-header">
                                        <ul class="nav nav-pills">
                                            <li class="nav-item"><a class="nav-link active" href="#previewProsiding" data-toggle="tab">Prosiding Artikel</a></li>
                                            <li class="nav-item"><a class="nav-link" href="#previewSimilaritas" data-toggle="tab">Cek Similaritas</a></li>
                                            <li class="nav-item"><a class="nav-link" href="#previewPAK" data-toggle="tab">Review PAK</a></li>
                                            <li class="nav-item"><a class="nav-link" href="#previewKorespondensi" data-toggle="tab">Korespondensi</a></li>
                                        </ul>
                                    </div><!-- /.card-header -->
                                    <div class="card-body">
                                        <div class="tab-content">
                                            <div class="active tab-pane" id="previewProsiding">
                                                Loading...

                                            </div>
                                            <div class=" tab-pane" id="previewSimilaritas">
                                                Loading...
                                            </div>
                                            <div class=" tab-pane" id="previewPAK">
                                                Loading...
                                            </div>
                                            <div class=" tab-pane" id="previewKorespondensi">
                                                Loading...
                                            </div>

                                        </div>
                                    </div>
                                </div>


                            </div>

                        </div>

                    </div>
                </div>
                @*<div class="modal-footer">
                        <button type="button" onclick="PostDokumenPendukung()" class="btn btn-primary">Save changes</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>*@
            </form>

        </div>
    </div>
</div>
<div class="modal fade" id="modalDokumenSister" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg mw-100 w-75" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Dokumen Sister</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">

                    <div id="accordion">

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{


    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    @*<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>*@
    <script src="https://cdn.datatables.net/responsive/2.0.2/js/dataTables.responsive.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

    <script>

        var dataTablePublikasiSISTER, dataTablePenelitianSISTER, dataTablePengabdianSISTER, dataTablePengajaranSISTER;
        var sweet_loader = '<div class="sweet_loader"><svg viewBox="0 0 140 140" width="140" height="140"><g class="outline"><path d="m 70 28 a 1 1 0 0 0 0 84 a 1 1 0 0 0 0 -84" stroke="rgba(0,0,0,0.1)" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></g><g class="circle"><path d="m 70 28 a 1 1 0 0 0 0 84 a 1 1 0 0 0 0 -84" stroke="#71BBFF" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dashoffset="200" stroke-dasharray="300"></path></g></svg></div>';
        var semester;
        var npp = ($('#nppa').val());
        $(document).ready(function () {
            semester = $(".selectSemester").val("20201");
            semester = "20201";
            var npp = ($('#nppa').val());

            dataTablePengajaranSISTER = $("#tabelpengajaran").DataTable({
                "paging": false,
                "ordering": false,

                "processing": true, // for show progress bar

                "filter": false, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/SimkaDosen/LoadDataPengajaranAsync?npp=" + npp,
                    "type": "POST",
                    "data": function (d) {
                        d.id_semester = semester
                    },
                    "datatype": "json"
                },
                "language": {
                    "emptyTable": "Tidak Ada Data Pada Sister"
                },
                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": true,
                        "searchable": true
                    }],


                "columns": [
                    {
                        "data": null, "sortable": false,
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        width: 100,
                    },
                    { "data": "mata_kuliah", "name": "nama_mata_kuliah", "autoWidth": true },
                    { "data": "semester", "name": "nama_jenis_evaluasi", "autoWidth": true },
                    { "data": "kelas", "name": "nama_kelas_kuliah", "autoWidth": true },


                    //
                ]

            });

            dataTablePublikasiSISTER = $("#tabelpublikasi").DataTable({
                dom: "<'row justify-content-between'<'justify-content-between mx-0 px-0'B>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-5'i><'col-sm-7'p>>",
                buttons: [{
                    extend: 'excel',
                    className: 'btn btn-secondary',
                    text: 'Export to Excel',
                    title: 'Data Publikasi',
                    filename: 'Publikasi'
                    ,

                }
                ],
                "paging": false,
                "ordering": false,

                "processing": true, // for show progress bar

                "filter": false, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/SimkaDosen/LoadDataPublikasi?npp=" + npp,
                    "type": "get",
                    "datatype": "json"
                },
                "language": {
                    "emptyTable": "Tidak Ada Data Pada Sister"
                },
                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": true,
                        "searchable": true
                    }],


                "columns": [
                    {
                        "data": null, "sortable": false,
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        width: 100,
                    },
                    { "data": "judul", "autoWidth": true },
                    { "data": "kategori_kegiatan", "autoWidth": true },
                    {
                        "data": "tanggal", title: "Tanggal Paten", width: "350px",
                        render: function (data) {
                            return moment(data).format('DD-MM-YYYY');
                        }
                    },
                    { "data": "peran", "autoWidth": true },
                    { "data": "urutan", "autoWidth": true },
                    /*{ "data": "nama_dokumen", "autoWidth": true },*/
                    {
                        "data": "id_publikasi",
                        width: "250px",
                        render: function (data) {
                            return "<button class='btn btn-primary btn-sm' onclick=GetDokumenSister('Publikasi','" + data + "') data-toggle='modal' data-target='#modalDokumenSister'> Dokumen Sister </button> ";
                        },
                    },
                    {
                        "data": "id_publikasi",
                        width: "250px",
                        render: function (data) {

                            return "<button class='btn btn-primary btn-sm' onclick=GetDokumenPendukung('Publikasi','" + data + "') data-toggle='modal' data-target='#myModal'> Dokumen Pendukung </button> "
                        }
                    }


                    //
                ]

            });

            dataTablePengabdianSISTER = $("#tabelpengabdian").DataTable({
                "paging": false,
                "ordering": false,

                "processing": true, // for show progress bar

                "filter": false, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/SimkaDosen/LoadDataPengabdian?npp=" + npp,
                    "type": "get",
                    "datatype": "json"
                },
                "language": {
                    "emptyTable": "Tidak Ada Data Pada Sister"
                },
                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": true,
                        "searchable": true,
                        "width": "80%"
                    }],


                "columns": [
                    {
                        "data": null, "sortable": false,
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        width: 100,
                    },
                    { "data": "judul_penelitian_pengabdian", "name": "nama_mata_kuliah", "autoWidth": true },

                    { "data": "durasi_kegiatan", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "jenis_skim", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "tahun_kegiatan", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "peran", "name": "nama_kelas_kuliah", "autowidth": true },

                ]

            });

            dataTablePenelitianSISTER = $("#penelitiansister").DataTable({
                "paging": false,
                "ordering": false,
                "paging": true,
                "processing": true, // for show progress bar

                "filter": false, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/SimkaDosen/LoadDataPenelitian?npp=" + npp,
                    "type": "get",
                    "datatype": "json"
                },
                "language": {
                    "emptyTable": "Tidak Ada Data Pada Sister"
                },
                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": true,
                        "searchable": true
                    }],


                "columns": [
                    {
                        "data": null, "sortable": false,
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        width: 100,
                    },
                    { "data": "judul_penelitian_pengabdian", "name": "nama_mata_kuliah", "autoWidth": true },

                    { "data": "durasi_kegiatan", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "jenis_skim", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "tahun_kegiatan", "name": "nama_kelas_kuliah", "autoWidth": true },
                    { "data": "peran", "name": "nama_kelas_kuliah", "autowidth": true },

                ]

            });

            $("#tabelpendidikan").DataTable({
                "paging": false,
                "ordering": false,
                "info": false,
                "processing": true, // for show progress bar
                "destroy": true,
                "filter": false, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {
                    "url": "/SimkaAdmin/LoadDataRiwayatPendidikans?npp=" + npp + "",
                    "type": "POST",
                    "datatype": "json"
                },


                "columns": [
                    {
                        "data": null, "sortable": false,
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    { "data": "namaSekolah", "name": "namaSekolah", "autoWidth": true },
                    { "data": "deskripsi", "name": "deskripsi", "autoWidth": true },
                    { "data": "programStudi", "name": "programStudi", "autoWidth": true },
                    { "data": "status", "name": "status", "autoWidth": true },
                    { "data": "tahunLulus", "name": "tahunLulus", "autoWidth": true },

                ]

            });


            dataTable = $('#tabelpengembangansimka').DataTable({
                "responsive": true,
                "paging": false,
                "ordering": false,
                "info": false,
                "ajax": {
                    "url": "/SimkaAdmin/LoadDataTrPengembanganDosen?npp=" + npp + "",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    {
                        data: "idTrPengembangan",
                        title: "ID",

                        type: "readonly",
                        "visible": true,

                    },
                    {
                        data: "refPe",
                        title: "Jenis Pengembangan",

                    }, {
                        data: "apr",
                        title: "Butir TriDharma",

                    },
                    {
                        data: "judul",
                        title: "Judul",

                    },


                ],
                "language": {
                    "emptyTable": "no data found."
                }
            });



        });
        function changeSelect() {
            semester = $(".selectSemester").val();

            //console.log("ini changeSelect")

            dataTablePengajaranSISTER.ajax.reload();
        }

        function SinkronPengabdianSISTER() {
            swal.fire({
                //icon: 'info',
                iconHtml: '<div class="loader"></div>',
                html: '<h5>Loading...</h5>',
                showCancelButton: false,
                showConfirmButton: false,
                allowOutsideClick: false

            });
            console.log("btn Pengabdian sister clicked")
            $.ajax({
                type: 'get',
                // url: 'https://jsonplaceholder.typicode.com/todos/1',
                url: '/SimkaDosen/SinkronDataPengabdianProdiSISTERbyNPP?npp=' + npp,


                datatype: 'json',
                success: function (data) {
                    if (data.success) {
                        console.log(data.message)
                        toastr.success("Sinkronisasi Pengabdian Berhasil");
                        dataTablePengabdianSISTER.ajax.reload();
                        swal.fire({
                            icon: 'success',
                            html: '<h5>Sinkronisasi Berhasil</h5>'
                        });
                    } else {
                        swal.fire({
                            icon: 'warning',
                            title: 'Sinkronisasi gagal',

                        });
                    }
                },
                error: function (data) {

                    console.log("ini gagal")
                    toastr.error("Sinkronisasi Pengabdian Gagal");
                    swal.fire({
                        icon: 'warning',
                        html: '<h5>Sinkronisasi Gagal</h5>'
                    });
                }
            });

            //swal.close();
            //setTimeout(function () {
            //    swal.close();
            //}, 3000);
        }

        function SinkronPenelitianSISTER() {
            swal.fire({
                //icon: 'info',
                iconHtml: '<div class="loader"></div>',
                html: '<h5>Loading...</h5>',
                showCancelButton: false,
                showConfirmButton: false,
                allowOutsideClick: false

            });
            console.log("btn penelitian sister clicked")
            $.ajax({
                type: 'get',
                // url: 'https://jsonplaceholder.typicode.com/todos/1',
                url: '/SimkaDosen/SinkronDataPenelitianSISTERbyNPP?npp=' + npp,


                datatype: 'json',
                success: function (data) {
                    if (data.success) {
                        console.log(data.message)
                        toastr.success("Sinkronisasi Penelitian Berhasil");
                        //dataTablePenelitianSISTER.ajax.reload();
                        swal.fire({
                            icon: 'success',
                            html: '<h5>Sinkronisasi Berhasil</h5>'
                        });
                    } else {
                        swal.fire({
                            icon: 'warning',
                            title: 'Sinkronisasi gagal',

                        });
                    }
                },
                error: function (data) {

                    console.log("ini gagal")
                    toastr.error("sinkronisasi penelitian gagal");
                    swal.fire({
                        icon: 'warning',
                        html: '<h5>Sinkronisasi Gagal</h5>'
                    });
                }
            });

            //swal.close();
            //setTimeout(function () {
            //    swal.close();
            //}, 3000);
        }

        function SinkronPengajaranSISTER() {
            var nama_semester = semester.substring(0, 4);
            if (semester.substring(4, 5) == "1")
                nama_semester += " Ganjil"
            else if (semester.substring(4, 5) == "2")
                nama_semester += " Genap"
            else if (semester.substring(4, 5) == "3")
                nama_semester += " Pendek"

            swal.fire({
                iconHtml: '<div class="loader"></div>',
                title: "Loading...",
                text: "Sedang Sinkronisasi Pengajaran Semester " + nama_semester,
                showCancelButton: false,
                showConfirmButton: false,
                allowOutsideClick: false

            });

            console.log("btn Pengajaran sister clicked")
            $.ajax({
                type: 'get',
                url: 'https://jsonplaceholder.typicode.com/todos/1',
                url: '/SimkaDosen/SinkronDataPengajaranProdiSISTERbyNPP?npp=' + npp,
                data: {
                    "id_semester": semester
                },


                datatype: 'json',
                success: function (data) {
                    if (data.success) {
                        console.log(data.message)
                        toastr.success("Sinkronisasi Pengajaran Berhasil");
                        dataTablePengajaranSISTER.ajax.reload();
                        swal.fire({
                            icon: 'success',
                            html: '<h5>Sinkronisasi Berhasil</h5>'
                        });
                    } else {
                        swal.fire({
                            icon: 'warning',
                            title: 'Sinkronisasi gagal',

                        });

                    }
                },
                error: function (data) {

                    console.log("ini gagal")
                    toastr.error("Sinkronisasi Pengajaran Gagal");
                    swal.fire({
                        icon: 'warning',
                        html: '<h5>Sinkronisasi Gagal</h5>'
                    });
                }
            });


        }

        function SinkronPublikasiSISTER() {
            swal.fire({
                //icon: 'info',
                iconHtml: '<div class="loader"></div>',
                html: '<h5>Loading...</h5>',
                showCancelButton: false,
                showConfirmButton: false,
                allowOutsideClick: false

            });
            console.log("btn Publikasi sister clicked")
            $.ajax({
                type: 'get',
                // url: 'https://jsonplaceholder.typicode.com/todos/1',
                url: '/SimkaDosen/SinkronDataPublikasiProdiSISTERbyNPP?npp=' + npp,



                datatype: 'json',
                success: function (data) {
                    if (data.success) {
                        toastr.success("Sinkronisasi Publikasi Berhasil");
                        dataTablePublikasiSISTER.ajax.reload();
                        swal.fire({
                            icon: 'success',
                            html: '<h5>Sinkronisasi Berhasil</h5>'
                        });
                    } else {
                        swal.fire({
                            icon: 'warning',
                            title: 'Sinkronisasi gagal',

                        });
                        console.log(data.message)
                    }
                },
                error: function (data) {

                    console.log("ini gagal")
                    toastr.error("Sinkronisasi Publikasi Gagal");
                    swal.fire({
                        icon: 'warning',
                        html: '<h5>Sinkronisasi Gagal</h5>'
                    });
                }
            });

            //swal.close();
            //setTimeout(function () {
            //    swal.close();
            //}, 3000);
        }

        function clickexport() {
            window.location.href = "/SimkaDosen/ExportPublikasi?npp=" + npp;
        }

        function tesLoadPenelitian() {
            $.ajax({
                type: 'get',
                // url: 'https://jsonplaceholder.typicode.com/todos/1',
                url: '/SimkaDosen/LoadDataPenelitian',


                datatype: 'json',
                success: function (data) {
                    console.log(data)
                },
                error: function (data) {

                    console.log("ini gagal")
                    toastr.error("Sinkronisasi Publikasi Gagal");
                    swal.fire({
                        icon: 'warning',
                        html: '<h5>Sinkronisasi Gagal</h5>'
                    });
                }
            });
        }

        function goToUbahPassword() {
            Swal.fire({
                title: 'Apakah Anda ingin melakukan reset password? ',
                text: ' Password akan direset ke "1234567"',
                showCancelButton: true,
                confirmButtonText: 'Ok',

            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'get',
                        // url: 'https://jsonplaceholder.typicode.com/todos/1',
                        url: '/SimkaAdmin/UbahPasswordAdmin?npp=' + npp,


                        datatype: 'json',
                        success: function (data) {
                            if (data.success) {
                                console.log(data.message)
                                toastr.success("Password Berhasil direset");
                                swal.fire({
                                    icon: 'success',
                                    title: "Password Berhasil direset"
                                });
                            } else {
                                swal.fire({
                                    icon: 'warning',
                                    title: 'Password gagal direset',
                                    text: data.message
                                });
                            }
                        },
                        error: function (data) {
                            console.log("ini gagal")
                            toastr.error("Reset Password Gagal");
                            swal.fire({
                                icon: 'warning',
                                title: "Reset Password Gagal"
                            });
                        }
                    });
                }
            })


        }
        function GetDokumenSister(jenis, id) {
            $('#accordion').empty();

            $('#accordion').html("Loading...");
            if (jenis == "Publikasi")
                url = "/SimkaDosen/GetArtikelPublikasi/";

            $.ajax({
                type: "get",
                url: url + id,
                datatype: "json",
                success: function (result) {
                    $('#accordion').empty();

                    var header;
                    var content;
                    $(result).each(function (index, value) {

                        var fileUrl = "data:application/pdf ;base64," + value["file_byte"];
                        fetch(fileUrl)
                            .then(response => response.blob())
                            .then(blob => {
                                var blobUrl = URL.createObjectURL(blob);

                                $('#accordion').append(
                                    "<div class='card'>" +
                                    "<div class='card-header' id='heading" + index + "'>" +
                                    "<h5 class='mb-0'>" +
                                    //"<button class='btn btn-link' data-toggle='collapse' data-target='#collapse"+index+"' aria-expanded='true' aria-controls='collapse"+index+"'>" +
                                    "<p>" + value["nama_file"] + "</p>" +
                                    //"</button>" +
                                    "</h5>" +
                                    "</div>" +
                                    "<div id='collapse" + index + "' class='collapse show' aria-labelledby='heading" + index + "' data-parent='#accordion'>" +
                                    "<div class='card-body'>" +
                                    "<iframe src='" + blobUrl + "' style='width:100%; height:400px;border-width:0px !important'></iframe>" +

                                    "</div>" +
                                    "</div>" +
                                    "</div>"
                                    /*"<p>tes</p>"+*/

                                );

                            });




                    });
                    return html;
                },
                error: function (result) {
                    return "<p>error</p>";
                }
            });
        }
        function GetDokumenPendukung(jenis, id) {
            $('#id').val(id);
            var url;
            //console.log("ini get dokumen Pendukung")
            //console.log("id" + id)
            if (jenis == "Publikasi")
                url = "/SimkaDosen/GetDokumenPendukung?jenis_tabel=Publikasi&id="
            $.ajax({
                type: "GET",
                url: url + id,
                dataType: "json",
                success: function (data) {
                    if (data.file_prosiding != null) {
                        appendPreview(data.file_prosiding, 'Prosiding', jenis, id)

                    } else {
                        $('#previewProsiding').html("<span>File belum diupload</span>");
                    }

                    if (data.file_cek_similaritas != null) {

                        appendPreview(data.file_cek_similaritas, 'Similaritas', jenis, id)

                    } else {
                        $('#previewSimilaritas').html("<span>File belum diupload</span>");
                    }

                    if (data.file_peer_review_pak != null) {

                        appendPreview(data.file_peer_review_pak, 'PAK', jenis, id)
                    } else {
                        $('#previewPAK').html("<span>File belum diupload</span>");
                    }

                    if (data.file_peer_korespondensi != null) {

                        appendPreview(data.file_peer_korespondensi, 'Korespondensi', jenis, id)

                    } else {
                        $('#previewKorespondensi').html("<span>File belum diupload</span>");
                    }



                    /* console.log(data);*/
                },
                error: function (data) {
                    console.log("get dokumen pendukung error")
                }
            });
        }

        function PostDokumenPendukung() {
            console.log("post dokumen Pendukung")
            var data = new FormData();
            jQuery.each(jQuery('#file_prosiding')[0].files, function (i, file) {
                data.append('file_prosiding', file);
            });
            jQuery.each(jQuery('#file_cek_similaritas')[0].files, function (i, file) {
                data.append('file_cek_similaritas', file);
            });
            jQuery.each(jQuery('#file_PAK')[0].files, function (i, file) {
                data.append('file_PAK', file);
            });
            jQuery.each(jQuery('#file_korespondensi')[0].files, function (i, file) {
                data.append('file_korespondensi', file);
            });

            data.append("id", $('#id').val());
            swal.fire({
                icon: 'info',
                html: '<h5>Loading...</h5>',
                showCancelButton: false,
                showConfirmButton: false,
                allowOutsideClick: false

            });

            $.ajax({
                processData: false,
                contentType: false,
                cache: false,
                type: "POST",
                url: "/SimkaDosen/PostDokumenPendukung",
                dataType: "json",
                data: data,
                enctype: "multipart/form-data",
                success: function (data) {
                    if (data.success) {
                        swal.fire({
                            icon: 'success',
                            //title: 'Upload Dokumen Berhasil',
                            text: data.message
                        });

                    } else {
                        console.log(data.message)
                        swal.fire({
                            icon: 'warning',
                            //title: 'Upload Dokumen Berhasil',
                            text: data.message
                        });

                    }

                    $('#myModal').modal('hide');

                },
                error: function (data) {
                    console.log("post dokumen pendukung error")
                    swal.fire({
                        icon: 'warning',
                        //title: 'Upload Dokumen Berhasil',
                        text: data.message
                    });
                    $('#myModal').modal('hide');


                },
                done: function (data) {
                    $('#myModal').modal('hide');



                }
            });

        }
        function getFileNameWithExt(event, id) {

            if (!event || !event.target || !event.target.files || event.target.files.length === 0) {
                return;
            }

            const name = event.target.files[0].name;
            const lastDot = name.lastIndexOf('.');

            const fileName = name.substring(0, lastDot);
            const ext = name.substring(lastDot + 1);

            $("#" + id).text(fileName + "." + ext)

        }
        // Reset Form Upload Dokumen
        $("#myModal").on('show.bs.modal', function () {
            $('#previewProsiding').html("<span>Loading...</span>");
            $('#previewSimilaritas').html("<span>Loading...</span>");
            $('#previewPAK').html("<span>Loading...</span>");
            $('#previewKorespondensi').html("<span>Loading...</span>");
            $('#labelProsiding').text("Choose File...");
            $('#labelSimilaritas').text("Choose File...");
            $('#labelPAK').text("Choose File...");
            $('#labelKorespondensi').text("Choose File...");



        });



        function copyToClipboard(input, btn) {
            /* Get the text field */
            console.log("ini text to copy")
            var copyText = document.getElementById(input);

            /* Select the text field */
            copyText.select();
            copyText.setSelectionRange(0, 99999); /* For mobile devices */

            /* Copy the text inside the text field */
            navigator.clipboard.writeText(copyText.value);

            /* Alert the copied text */
            document.getElementById(btn).innerHTML = 'Copied';
            setTimeout(function () {
                document.getElementById(btn).innerHTML = 'Copy';

            }, 2000);
        }

        function appendPreview(data, jenis_file, jenis_tabel, id) {
            var fileUrl = "data:application/pdf ;base64," + data;
            fetch(fileUrl)
                .then(response => response.blob())
                .then(blob => {
                    var blobUrl = URL.createObjectURL(blob);

                    $('#preview' + jenis_file).html(
                        "<label>Link URL</label>" +
                        "<div class='d-flex mb-3'>" +
                        "<div class='flex-grow-1'>" +
                        "<input type='text' id='link" + jenis_file + jenis_tabel + "' class='form-control' readonly value='" + window.location.origin + "/ViewDokumen/ViewDokumen" + jenis_file + "?id=" + id + "&jenis_tabel=" + jenis_tabel + "'>" +
                        //"<input type='text' id='link" + jenis_file + jenis_tabel + "' class='form-control' readonly value='https://simka2-dev.uajy.ac.id/ViewDokumen/ViewDokumen" + jenis_file + "?id=" + id + "&jenis_tabel=" + jenis_tabel + "'>" +

                        "</div>" +
                        "<div class=' pl-3'>" +

                        "<button class='btn btn-success' style='width:100px' id='btn" + jenis_file + jenis_tabel + "' type='button' onclick=copyToClipboard('link" + jenis_file + jenis_tabel + "','btn" + jenis_file + jenis_tabel + "')>Copy</button>" +
                        "</div>" +
                        "</div>" +

                        "<iframe src='" + blobUrl + "' style='width:100%; height:400px;border-width:0px !important'></iframe>"
                    );
                });
        }
    </script>
}
